<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upper Body Hypertrophy & Lower Body Strength Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral -->
    <!-- Application Structure Plan: The SPA is designed with a top navigation bar to switch between sections: 'Overview', 'The Plan', 'Key Concepts', 'Logs', and 'Data Management'. This tabbed structure was chosen to organize the dense 16-week schedule and related features into logical, digestible parts. 'The Plan' is the core interactive component for viewing workouts and logging sessions. 'Session Logs' allows for viewing and managing saved data locally. 'Data Management' adds Google Sheets integration for backup and recovery, now with automated sheet creation. This architecture supports a full workflow from planning, to execution, to data persistence. -->
    <!-- Visualization & Content Choices: Report Info: Program's weekly volume. Goal: Compare upper vs. lower body focus. Viz: Chart.js Bar Chart. Interaction: Hover for details. Justification: Visually confirms the program's core philosophy of high upper-body volume. | Report Info: 16 weeks of daily workouts. Goal: Organize and display specific workouts. Presentation: Interactive week/day selector and logging modal. Interaction: User selects week/day to view plan and log performance. Justification: Breaks down a massive amount of text into a manageable, task-oriented format. All diagrams and layouts use HTML/CSS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #333333;
        }
        .nav-link {
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active {
            border-bottom-color: #C5A06D;
            color: #C5A06D;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .day-tab.active {
            background-color: #C5A06D;
            color: #FFFFFF;
        }
        #log-modal, #gapi-modal {
            transition: opacity 0.3s ease;
        }
        .g-button {
            background-color: #4285F4;
            color: white;
        }
        .g-button:hover {
            background-color: #357ae8;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Upper Body Hypertrophy & Lower Strength Plan</h1>
            <p class="text-lg text-gray-600 mt-2">Your interactive 16-week training schedule</p>
        </header>

        <nav class="flex flex-wrap justify-center border-b border-gray-200 mb-8">
            <button class="nav-link active py-4 px-6 text-lg font-medium text-gray-500 hover:text-gray-800" data-target="overview">Overview</button>
            <button class="nav-link py-4 px-6 text-lg font-medium text-gray-500 hover:text-gray-800" data-target="plan">The Plan</button>
            <button class="nav-link py-4 px-6 text-lg font-medium text-gray-500 hover:text-gray-800" data-target="concepts">Key Concepts</button>
            <button class="nav-link py-4 px-6 text-lg font-medium text-gray-500 hover:text-gray-800" data-target="logs">Session Logs</button>
            <button class="nav-link py-4 px-6 text-lg font-medium text-gray-500 hover:text-gray-800" data-target="data">Data Management</button>
        </nav>

        <main>
            <section id="overview" class="space-y-8">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Program Philosophy</h2>
                    <p class="text-gray-700 leading-relaxed">This is a 4-day per week program using an **Upper, Lower, Upper, Upper split** designed for an experienced lifter. The primary goal is to maximize hypertrophy (size) in the shoulders and arms. The secondary goal is to increase strength in the lower body (squat, deadlift) with minimal size gain. This is achieved through high volume and frequency for the upper body, contrasted with low volume and high intensity for the lower body.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Training Volume Progression</h2>
                     <p class="text-gray-700 leading-relaxed mb-6">This chart visualizes the core principle of the program: a significant emphasis on upper body volume compared to lower body. Notice how the total weekly sets for the upper body consistently outnumber the lower body, driving muscle growth where it's prioritized. You can hover over the bars to see the exact number of working sets for each 4-week block.</p>
                    <div class="chart-container">
                        <canvas id="volumeChart"></canvas>
                    </div>
                </div>
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Equipment Notes</h2>
                    <p class="text-gray-700 leading-relaxed">This plan has been adapted for your specific equipment. Dumbbell, cable, and machine exercises have been replaced with barbell, kettlebell, bodyweight, and band variations. When the 16kg kettlebell becomes too light, focus on increasing reps or slowing down the tempo to maintain progressive overload.</p>
                </div>
            </section>

            <section id="plan" class="hidden space-y-8">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Select Your Week</h2>
                    <p class="text-gray-700 leading-relaxed mb-4">Use the dropdown below to select a week. The workout plan for the four training days of that week will be displayed. Each 4-week block has a different focus: Foundation, Intensification, High Volume, and finally, a Peak block to realize your strength and size gains.</p>
                    <select id="week-selector" class="w-full p-3 border border-gray-300 rounded-md bg-white text-lg">
                    </select>
                </div>
                <div id="workout-display" class="bg-white p-6 rounded-lg shadow-sm">
                </div>
            </section>

            <section id="concepts" class="hidden space-y-6">
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Key Concepts</h2>
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700">Rate of Perceived Exertion (RPE)</h3>
                             <ul class="list-disc list-inside space-y-2 text-gray-700 mt-2">
                                <li><span class="font-semibold">RPE 10:</span> Maximum effort, no more reps possible.</li>
                                <li><span class="font-semibold">RPE 9:</span> One rep left in the tank.</li>
                                <li><span class="font-semibold">RPE 8:</span> Two reps left in the tank.</li>
                            </ul>
                        </div>
                        <div>
                             <h3 class="text-xl font-semibold text-gray-700">Progressive Overload</h3>
                            <p class="text-gray-700 leading-relaxed mt-2">Progress is driven by consistently challenging your body. This is done by adding weight for strength lifts and adding reps for hypertrophy lifts.</p>
                        </div>
                         <div>
                             <h3 class="text-xl font-semibold text-gray-700">Rest Periods</h3>
                             <p class="text-gray-700 leading-relaxed mt-2">Rest 3-5 minutes for main lifts and 60-120 seconds for accessories to ensure optimal performance.</p>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700">A Note on Neck Training</h3>
                            <p class="text-gray-700 leading-relaxed mt-2">Always start light, use slow and controlled movements, and stop if you feel any pain. Progress very gradually.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="logs" class="hidden space-y-6">
                 <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Your Session History</h2>
                    <p class="text-gray-700 leading-relaxed mb-4">This section displays all the workout sessions you have logged locally in your browser. Use the "Data Management" tab to sync this data with Google Sheets.</p>
                    <div id="logs-container" class="space-y-4">
                        <p>No sessions logged yet.</p>
                    </div>
                </div>
            </section>

            <section id="data" class="hidden space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Google Sheets Integration</h2>
                     <div class="prose prose-sm max-w-none">
                        <p>To back up your logs, this app can create and manage a Google Sheet in your Google Drive. This requires a Client ID from Google to authorize the application.</p>
                        <ol>
                            <li><a href="https://developers.google.com/workspace/guides/create-credentials" target="_blank" class="text-blue-600 hover:underline">Follow these instructions to create your OAuth 2.0 Client ID</a>.
                                <ul class="list-disc pl-6">
                                    <li>When asked for an "Application type", choose "Web application".</li>
                                    <li>Under "Authorized JavaScript origins", add the URL where this app is hosted.</li>
                                </ul>
                            </li>
                            <li>Paste the Client ID below and log in.</li>
                        </ol>
                    </div>
                    <div class="mt-4">
                        <input type="text" id="client_id_input" placeholder="Paste your Google Client ID here" class="w-full p-2 border rounded">
                    </div>
                    <div id="auth-container" class="mt-4">
                        <button id="authorize_button" class="g-button font-bold py-2 px-4 rounded">Log In with Google</button>
                        <button id="signout_button" class="hidden bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-600">Log Out</button>
                    </div>
                    <p id="auth-status" class="mt-4 text-sm"></p>
                </div>

                <div id="gapi-controls" class="hidden bg-white p-6 rounded-lg shadow-sm space-y-4">
                    <h3 class="text-xl font-semibold">Data Sync</h3>
                    <div id="sheet-info-container" class="text-sm">
                        <p>No Google Sheet linked. The first time you sync, a new sheet named 'Workout Logs SPA' will be created in your Google Drive.</p>
                    </div>
                    <div class="flex space-x-4 pt-4">
                        <button id="sync_to_sheets_button" class="flex-1 bg-green-600 text-white font-bold py-2 px-4 rounded hover:bg-green-700">Sync to Sheets</button>
                        <button id="load_from_sheets_button" class="flex-1 bg-blue-600 text-white font-bold py-2 px-4 rounded hover:bg-blue-700">Load from Sheets</button>
                    </div>
                    <p id="sheets-status" class="mt-4 text-sm"></p>
                </div>
            </section>
        </main>
    </div>

    <div id="log-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 opacity-0">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b"><h3 id="log-modal-title" class="text-2xl font-bold">Log Session</h3></div>
            <div id="log-modal-body" class="p-6 space-y-4"></div>
            <div class="p-6 bg-gray-50 flex justify-end space-x-4">
                <button id="cancel-log-btn" class="px-6 py-2 rounded-md bg-gray-200 text-gray-800 hover:bg-gray-300">Cancel</button>
                <button id="save-log-btn" class="px-6 py-2 rounded-md bg-green-600 text-white hover:bg-green-700">Save Log</button>
            </div>
        </div>
    </div>
    
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

    <script>
        const programData = {
            "weeks": [
                {
                    "block": "Foundation Block (Weeks 1-4)",
                    "days": [
                        {"day": "Day 1: Upper Body (Push Focus)", "exercises": ["Bench Press: 3 sets of 5 reps @ RPE 8", "Standing Overhead Press (OHP): 3 sets of 6-8 reps @ RPE 8", "Weighted Dips: 3 sets of 8-12 reps @ RPE 8", "Plate Lateral Raises: 3 sets of 12-15 reps @ RPE 9", "Barbell Curls: 3 sets of 8-12 reps @ RPE 9"]},
                        {"day": "Day 2: Lower Body (Strength Focus)", "exercises": ["Back Squat: 3 sets of 5 reps @ RPE 8", "Conventional or Sumo Deadlift: 3 sets of 4 reps @ RPE 8", "Barbell Hip Thrusts: 3 sets of 8-10 reps @ RPE 8", "Plate Neck Curls: 2 sets of 15-20 reps @ RPE 8"]},
                        {"day": "Day 3: Upper Body (Pull Focus)", "exercises": ["Weighted Pull-ups: 3 sets of 6-10 reps @ RPE 8", "Barbell Rows: 3 sets of 8-12 reps @ RPE 8", "T-Bar Rows (use landmine setup): 3 sets of 10-12 reps @ RPE 8", "Skull Crushers (EZ-Bar): 3 sets of 10-15 reps @ RPE 9", "EZ-Bar Curls: 3 sets of 10-15 reps @ RPE 9"]},
                        {"day": "Day 4: Upper Body (Arms & Shoulders Hypertrophy)", "exercises": ["Close Grip Bench Press: 3 sets of 8-12 reps @ RPE 8", "Seated Barbell Shoulder Press: 3 sets of 10-15 reps @ RPE 9", "Bent-Over Plate Rear Delt Raises: 4 sets of 15-20 reps @ RPE 9", "Overhead EZ-Bar Tricep Extensions: 4 sets of 12-15 reps @ RPE 9", "Reverse Barbell Curls: 4 sets of 10-15 reps @ RPE 9", "Plate-Loaded Neck Extensions: 2 sets of 15-20 reps @ RPE 8"]}
                    ]
                },
                {
                    "block": "Intensification Block (Weeks 5-8)",
                    "days": [
                        {"day": "Day 1: Upper Body (Push Focus)", "exercises": ["Bench Press: 4 sets of 4 reps @ RPE 8", "Standing Overhead Press (OHP): 4 sets of 5-7 reps @ RPE 8", "Weighted Dips: 4 sets of 6-10 reps @ RPE 8", "Plate Lateral Raises: 4 sets of 12-15 reps @ RPE 9", "Barbell Curls: 4 sets of 8-12 reps @ RPE 9"]},
                        {"day": "Day 2: Lower Body (Strength Focus)", "exercises": ["Back Squat: 4 sets of 4 reps @ RPE 8", "Romanian Deadlifts (RDLs): 3 sets of 6-8 reps @ RPE 7", "Barbell Hip Thrusts: 3 sets of 6-8 reps @ RPE 8 (with a 1-second pause at top)", "Plate Neck Curls: 2 sets of 15-20 reps @ RPE 8"]},
                        {"day": "Day 3: Upper Body (Pull Focus)", "exercises": ["Weighted Pull-ups: 4 sets of 5-8 reps @ RPE 8", "Barbell Rows: 4 sets of 6-10 reps @ RPE 8", "T-Bar Rows (use landmine setup): 4 sets of 8-12 reps @ RPE 8", "Skull Crushers (EZ-Bar): 4 sets of 10-12 reps @ RPE 9", "EZ-Bar Curls: 4 sets of 10-12 reps @ RPE 9"]},
                        {"day": "Day 4: Upper Body (Arms & Shoulders Hypertrophy)", "exercises": ["Close Grip Bench Press: 4 sets of 8-12 reps @ RPE 8", "Seated Barbell Shoulder Press: 4 sets of 10-15 reps @ RPE 9", "Bent-Over Plate Rear Delt Raises: 4 sets of 15-20 reps @ RPE 9", "Overhead EZ-Bar Tricep Extensions: 4 sets of 12-15 reps @ RPE 9", "Reverse Barbell Curls: 4 sets of 10-15 reps @ RPE 9", "Plate-Loaded Neck Extensions: 2 sets of 15-20 reps @ RPE 8"]}
                    ]
                },
                {
                    "block": "High Volume Block (Weeks 9-12)",
                    "days": [
                        {"day": "Day 1: Upper Body (Push Focus)", "exercises": ["Bench Press: 3 sets of 6 reps @ RPE 8", "Push Press: 3 sets of 5-6 reps @ RPE 8", "Weighted Dips: 3 sets of 10-15 reps @ RPE 8", "Plate Lateral Raises: 4 sets of 15-20 reps @ RPE 9", "Barbell Curls: 4 sets of 10-12 reps @ RPE 9 (include 1 drop set on the last set)"]},
                        {"day": "Day 2: Lower Body (Strength Focus)", "exercises": ["Back Squat: 3 sets of 6 reps @ RPE 8", "Deficit Deadlifts (stand on a 1-2 inch plate): 3 sets of 5 reps @ RPE 8", "Barbell Hip Thrusts: 3 sets of 10-12 reps @ RPE 8", "Plate Neck Curls: 2 sets of 15-20 reps @ RPE 8"]},
                        {"day": "Day 3: Upper Body (Pull Focus)", "exercises": ["Weighted Pull-ups: 3 sets of 8-12 reps @ RPE 8", "Barbell Rows: 4 sets of 10-12 reps @ RPE 8", "T-Bar Rows (use landmine setup): 4 sets of 12-15 reps @ RPE 8", "Skull Crushers (EZ-Bar): 4 sets of 12-15 reps @ RPE 9", "EZ-Bar Curls: 4 sets of 12-15 reps @ RPE 9"]},
                        {"day": "Day 4: Upper Body (Arms & Shoulders Hypertrophy)", "exercises": ["Close Grip Bench Press: 4 sets of 10-15 reps @ RPE 8", "Bradford Press: 3 sets of 10-12 reps @ RPE 9", "Bent-Over Plate Rear Delt Raises: 5 sets of 20-25 reps @ RPE 9", "Overhead EZ-Bar Tricep Extensions: 5 sets of 15-20 reps @ RPE 9", "Reverse Barbell Curls: 5 sets of 12-15 reps @ RPE 9", "Plate-Loaded Neck Extensions: 2 sets of 15-20 reps @ RPE 8"]}
                    ]
                },
                {
                    "block": "Peak Block (Weeks 13-16)",
                    "days": [
                        {"day": "Day 1: Upper Body (Push Focus)", "exercises": ["Bench Press: Work up to a top set of 3 reps @ RPE 9. Then 2 back-off sets of 5 reps @ RPE 8.", "Standing Overhead Press (OHP): Work up to a top set of 3-5 reps @ RPE 9.", "Weighted Dips: 4 sets of 5-8 reps @ RPE 9", "Plate Lateral Raises: 5 sets of 10-15 reps @ RPE 9 (use myo-reps*)", "Barbell Curls: 3 sets of 6-8 reps @ RPE 9"]},
                        {"day": "Day 2: Lower Body (Strength Focus)", "exercises": ["Back Squat: Work up to a top set of 1-3 reps @ RPE 9.", "Conventional or Sumo Deadlift: Work up to one top set of 1-3 reps @ RPE 9.", "Barbell Hip Thrusts: 3 sets of 5-8 reps @ RPE 8 (with a 2-second pause at the top)", "Plate Neck Curls: 2 sets of 15-20 reps @ RPE 8"]},
                        {"day": "Day 3: Upper Body (Pull Focus)", "exercises": ["Weighted Pull-ups: Work up to a top set of 3-5 reps @ RPE 9. Then 2 back-off sets of 8 reps @ RPE 8.", "Barbell Rows: 3 sets of 6-8 reps @ RPE 8", "T-Bar Rows (use landmine setup): 3 sets of 8-10 reps @ RPE 8", "Skull Crushers (EZ-Bar): 3 sets of 8-10 reps @ RPE 9", "EZ-Bar Curls: 3 sets of 8-10 reps @ RPE 9"]},
                        {"day": "Day 4: Upper Body (Arms & Shoulders Hypertrophy)", "exercises": ["Close Grip Bench Press: 3 sets of 6-10 reps @ RPE 9", "Seated Barbell Shoulder Press: 3 sets of 8-12 reps @ RPE 9", "Bent-Over Plate Rear Delt Raises: 4 sets of 12-15 reps @ RPE 9", "Overhead EZ-Bar Tricep Extensions: 4 sets of 10-12 reps @ RPE 9 (use drop sets)", "Reverse Barbell Curls: 4 sets of 10-12 reps @ RPE 9 (use drop sets)", "Plate-Loaded Neck Extensions: 2 sets of 15-20 reps @ RPE 8"]}
                    ]
                }
            ]
        };

        let gapiInited = false;
        let gisInited = false;
        let tokenClient;
        
        const CLIENT_ID_INPUT = document.getElementById('client_id_input');
        const authorizeButton = document.getElementById('authorize_button');
        const signoutButton = document.getElementById('signout_button');
        const gapiControls = document.getElementById('gapi-controls');
        const authStatus = document.getElementById('auth-status');
        const sheetsStatus = document.getElementById('sheets-status');
        const syncToSheetsButton = document.getElementById('sync_to_sheets_button');
        const loadFromSheetsButton = document.getElementById('load_from_sheets_button');
        const sheetInfoContainer = document.getElementById('sheet-info-container');

        function gapiLoaded() {
            gapi.load('client', () => {
                gapiInited = true;
            });
        }

        function gisLoaded() {
            gisInited = true;
        }
        
        async function initializeGapiClient() {
            await gapi.client.init({
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4', 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
            });
        }
        
        authorizeButton.onclick = async () => {
            if (!CLIENT_ID_INPUT.value) {
                authStatus.textContent = 'Please provide your Google Client ID.';
                return;
            }
            if (!gapiInited || !gisInited) {
                authStatus.textContent = 'Google API scripts are not loaded yet.';
                return;
            }

            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID_INPUT.value,
                scope: 'https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file',
                callback: async (resp) => {
                    if (resp.error !== undefined) {
                        authStatus.textContent = `Error: ${resp.error}`;
                        throw (resp);
                    }
                    await initializeGapiClient();
                    authorizeButton.classList.add('hidden');
                    signoutButton.classList.remove('hidden');
                    gapiControls.classList.remove('hidden');
                    authStatus.textContent = 'Successfully authorized!';
                    updateSheetInfo();
                },
            });

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        };

        signoutButton.onclick = () => {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                authorizeButton.classList.remove('hidden');
                signoutButton.classList.add('hidden');
                authStatus.textContent = 'You have been signed out.';
                gapiControls.classList.add('hidden');
            }
        };

        const updateSheetInfo = () => {
            const spreadsheetId = localStorage.getItem('spreadsheetId');
            if (spreadsheetId) {
                sheetInfoContainer.innerHTML = `
                    <p>Linked to Google Sheet: <a href="https://docs.google.com/spreadsheets/d/${spreadsheetId}" target="_blank" class="text-blue-600 hover:underline">${spreadsheetId}</a></p>
                `;
            } else {
                 sheetInfoContainer.innerHTML = "<p>No Google Sheet linked. The first time you sync, a new sheet named 'Workout Logs SPA' will be created in your Google Drive.</p>";
            }
        };

        async function createSheetIfNotExists() {
            let spreadsheetId = localStorage.getItem('spreadsheetId');
            if (spreadsheetId) {
                return spreadsheetId;
            }
            
            sheetsStatus.textContent = 'No sheet found. Creating a new one...';
            try {
                const response = await gapi.client.drive.files.create({
                    resource: {
                        name: 'Workout Logs SPA',
                        mimeType: 'application/vnd.google-apps.spreadsheet',
                    },
                });
                spreadsheetId = response.result.id;
                localStorage.setItem('spreadsheetId', spreadsheetId);
                updateSheetInfo();
                sheetsStatus.textContent = 'New Google Sheet created successfully.';
                return spreadsheetId;
            } catch (err) {
                 sheetsStatus.textContent = `Error creating sheet: ${err.result.error.message}`;
                 return null;
            }
        }

        syncToSheetsButton.onclick = async () => {
            sheetsStatus.textContent = "Starting sync...";
            const spreadsheetId = await createSheetIfNotExists();
            if (!spreadsheetId) return;

            sheetsStatus.textContent = "Syncing data to sheet...";
            const logs = JSON.parse(localStorage.getItem('workoutLogs')) || [];
            const values = [["Date", "Week", "DayName", "Exercise", "Weight(kg)", "Reps", "RPE"]];
            logs.forEach(log => {
                log.exercises.forEach(ex => {
                    ex.sets.forEach(set => {
                         values.push([log.date, log.week, log.dayName, ex.name, set.weight, set.reps, set.rpe]);
                    });
                });
            });

            try {
                await gapi.client.sheets.spreadsheets.values.clear({ spreadsheetId, range: 'Sheet1' });
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId,
                    range: 'Sheet1!A1',
                    valueInputOption: 'USER_ENTERED',
                    resource: { values },
                });
                sheetsStatus.textContent = "Successfully synced to Google Sheets!";
            } catch (err) {
                sheetsStatus.textContent = `Error syncing: ${err.result.error.message}`;
            }
        };
        
        loadFromSheetsButton.onclick = async () => {
            const spreadsheetId = localStorage.getItem('spreadsheetId');
            if (!spreadsheetId) {
                sheetsStatus.textContent = "No sheet linked. Please sync data first to create one.";
                return;
            }
            sheetsStatus.textContent = "Loading from sheet...";

            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({ spreadsheetId, range: 'Sheet1!A:G' });
                const rows = response.result.values;
                if (!rows || rows.length <= 1) {
                    sheetsStatus.textContent = "Sheet is empty or has no data to load.";
                    return;
                }
                
                const logMap = {};
                rows.slice(1).forEach(row => {
                    const [date, week, dayName, exName, weight, reps, rpe] = row;
                    if (!date) return;
                    if (!logMap[date]) logMap[date] = { date, week, dayName, exercises: {} };
                    if (!logMap[date].exercises[exName]) logMap[date].exercises[exName] = { name: exName, sets: [] };
                    logMap[date].exercises[exName].sets.push({ weight, reps, rpe });
                });

                const newLogs = Object.values(logMap).map(log => ({ ...log, exercises: Object.values(log.exercises) }));
                
                localStorage.setItem('workoutLogs', JSON.stringify(newLogs));
                loadLogs(); 
                if (document.querySelector('.nav-link[data-target="logs"]').classList.contains('active')) renderLogs();
                sheetsStatus.textContent = "Successfully loaded data from Google Sheets!";

            } catch (err) {
                 sheetsStatus.textContent = `Error loading data: ${err.result.error.message}`;
            }
        };

        let sessionLogs = [];
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('main section');
        const weekSelector = document.getElementById('week-selector');
        const workoutDisplay = document.getElementById('workout-display');
        const logModal = document.getElementById('log-modal');
        const logModalTitle = document.getElementById('log-modal-title');
        const logModalBody = document.getElementById('log-modal-body');
        const saveLogBtn = document.getElementById('save-log-btn');
        const cancelLogBtn = document.getElementById('cancel-log-btn');
        const logsContainer = document.getElementById('logs-container');

        const loadLogs = () => {
            sessionLogs = JSON.parse(localStorage.getItem('workoutLogs')) || [];
        };
        const saveLogs = () => {
            localStorage.setItem('workoutLogs', JSON.stringify(sessionLogs));
        };
        const renderLogs = () => {
            logsContainer.innerHTML = '';
            if (sessionLogs.length === 0) {
                logsContainer.innerHTML = '<p>No sessions logged yet.</p>';
                return;
            }
            const groupedLogs = sessionLogs.reduce((acc, log) => {
                const date = new Date(log.date).toLocaleDateString();
                if (!acc[date]) acc[date] = [];
                acc[date].push(log);
                return acc;
            }, {});
            const sortedDates = Object.keys(groupedLogs).sort((a, b) => new Date(b) - new Date(a));
            logsContainer.innerHTML = sortedDates.map(date => {
                const logsForDate = groupedLogs[date];
                const dateHeader = `<h3 class="text-xl font-bold mt-4 pt-4 border-t">${date}</h3>`;
                return dateHeader + logsForDate.map(log => `
                    <div class="p-4 bg-gray-50 rounded-lg mt-2">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold">${log.dayName} (Week ${log.week})</h4>
                                <ul class="mt-2 space-y-1 text-sm text-gray-600">
                                    ${log.exercises.map(ex => `<li><strong>${ex.name}:</strong> ${ex.sets.map(s => `${s.weight}kg x ${s.reps} @RPE${s.rpe}`).join(', ')}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="flex space-x-2 flex-shrink-0 ml-4">
                                <button class="edit-log-btn text-sm text-blue-600 hover:underline" data-log-id="${log.date}">Edit</button>
                                <button class="delete-log-btn text-sm text-red-600 hover:underline" data-log-id="${log.date}">Delete</button>
                            </div>
                        </div>
                    </div>`).join('');
            }).join('');
        };
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                const target = link.dataset.target;
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');
                sections.forEach(section => section.classList.toggle('hidden', section.id !== target));
                if (target === 'logs') renderLogs();
            });
        });
        for (let i = 1; i <= 16; i++) {
            weekSelector.add(new Option(`Week ${i}`, i));
        }
        const getBlockIndex = (week) => Math.floor((week - 1) / 4);
        const openLogModal = (week, dayIndex, existingLog = null) => {
            let dayData, modalTitle;
            if (existingLog) {
                const blockIndex = getBlockIndex(existingLog.week);
                dayData = programData.weeks[blockIndex].days.find(d => d.day === existingLog.dayName);
                modalTitle = `Edit Session: Week ${existingLog.week} - ${existingLog.dayName}`;
            } else {
                const blockIndex = getBlockIndex(week);
                dayData = programData.weeks[blockIndex].days[dayIndex];
                modalTitle = `Log Session: Week ${week} - ${dayData.day}`;
            }
            logModalTitle.textContent = modalTitle;
            logModalBody.innerHTML = dayData.exercises.map(exercise => {
                const exName = exercise.split(':')[0];
                const existingEx = existingLog ? existingLog.exercises.find(e => e.name === exName) : null;
                const setsHtml = existingEx ? existingEx.sets.map(set => `<div class="flex items-center space-x-2"><input type="number" class="log-weight w-1/3 p-2 border rounded" value="${set.weight}"><input type="number" class="log-reps w-1/3 p-2 border rounded" value="${set.reps}"><input type="number" class="log-rpe w-1/3 p-2 border rounded" value="${set.rpe}"></div>`).join('') : `<div class="flex items-center space-x-2"><input type="number" placeholder="Weight (kg)" class="log-weight w-1/3 p-2 border rounded"><input type="number" placeholder="Reps" class="log-reps w-1/3 p-2 border rounded"><input type="number" placeholder="RPE" class="log-rpe w-1/3 p-2 border rounded"></div>`;
                return `<div class="space-y-2 pb-4 border-b" data-exercise-name="${exName}"><label class="font-semibold text-gray-800">${exName}</label><p class="text-sm text-gray-500">${exercise.split(':')[1]}</p><div class="sets-container space-y-2">${setsHtml}</div><button type="button" class="add-set-btn text-sm text-green-600 hover:text-green-800">+ Add Set</button></div>`;
            }).join('');
            if (existingLog) saveLogBtn.dataset.editId = existingLog.date;
            else {
                saveLogBtn.dataset.week = week;
                saveLogBtn.dataset.dayIndex = dayIndex;
                saveLogBtn.removeAttribute('data-edit-id');
            }
            logModal.classList.remove('hidden');
            setTimeout(() => logModal.classList.remove('opacity-0'), 10);
        };
        const closeLogModal = () => {
            logModal.classList.add('opacity-0');
            setTimeout(() => logModal.classList.add('hidden'), 300);
        };
        logModalBody.addEventListener('click', e => {
            if (e.target.classList.contains('add-set-btn')) {
                const setsContainer = e.target.previousElementSibling;
                setsContainer.insertAdjacentHTML('beforeend', `<div class="flex items-center space-x-2"><input type="number" placeholder="Weight (kg)" class="log-weight w-1/3 p-2 border rounded"><input type="number" placeholder="Reps" class="log-reps w-1/3 p-2 border rounded"><input type="number" placeholder="RPE" class="log-rpe w-1/3 p-2 border rounded"></div>`);
            }
        });
        const buildLogFromModal = () => {
            const exercises = [];
            logModalBody.querySelectorAll('[data-exercise-name]').forEach(form => {
                const exerciseLog = { name: form.dataset.exerciseName, sets: [] };
                form.querySelectorAll('.sets-container > div').forEach(set => {
                    const weight = set.querySelector('.log-weight').value, reps = set.querySelector('.log-reps').value, rpe = set.querySelector('.log-rpe').value;
                    if (weight && reps && rpe) exerciseLog.sets.push({ weight, reps, rpe });
                });
                if (exerciseLog.sets.length > 0) exercises.push(exerciseLog);
            });
            return { exercises };
        };
        saveLogBtn.addEventListener('click', () => {
            const editId = saveLogBtn.dataset.editId;
            const logData = buildLogFromModal();
            if (editId) {
                const logIndex = sessionLogs.findIndex(log => log.date === editId);
                if (logIndex > -1) sessionLogs[logIndex].exercises = logData.exercises;
            } else {
                const week = saveLogBtn.dataset.week, dayIndex = saveLogBtn.dataset.dayIndex, blockIndex = getBlockIndex(week);
                const newLog = { date: new Date().toISOString(), week, dayName: programData.weeks[blockIndex].days[dayIndex].day, exercises: logData.exercises };
                if (newLog.exercises.length > 0) sessionLogs.push(newLog);
            }
            saveLogs();
            if (document.querySelector('.nav-link[data-target="logs"]').classList.contains('active')) renderLogs();
            closeLogModal();
        });
        cancelLogBtn.addEventListener('click', closeLogModal);
        logsContainer.addEventListener('click', e => {
            const logId = e.target.dataset.logId;
            if (!logId) return;
            if (e.target.classList.contains('delete-log-btn')) {
                const logIndex = sessionLogs.findIndex(log => log.date === logId);
                if (logIndex > -1) {
                    sessionLogs.splice(logIndex, 1);
                    saveLogs();
                    renderLogs();
                }
            }
            if (e.target.classList.contains('edit-log-btn')) {
                const logToEdit = sessionLogs.find(log => log.date === logId);
                if (logToEdit) openLogModal(null, null, logToEdit);
            }
        });
        const displayWorkout = (week) => {
            const blockIndex = getBlockIndex(week);
            const weekData = programData.weeks[blockIndex];
            let html = `<h3 class="text-xl font-bold mb-4">${weekData.block} - Week ${week}</h3>`;
            html += `<div class="flex flex-wrap -mx-2 mb-4">`;
            weekData.days.forEach((day, index) => {
                html += `<button class="day-tab flex-1 m-2 py-2 px-4 rounded-md transition-colors duration-300 border border-gray-200 ${index === 0 ? 'active' : 'bg-gray-100'}" data-day="${index}">${day.day.split(':')[0]}</button>`;
            });
            html += `</div>`;
            html += `<div>`;
            weekData.days.forEach((day, index) => {
                html += `<div class="day-content ${index === 0 ? '' : 'hidden'}" data-day-content="${index}">`;
                html += `<h4 class="text-lg font-semibold mb-3">${day.day}</h4><ul class="space-y-2 text-gray-700">${day.exercises.map(ex => `<li class="p-3 bg-gray-50 rounded-md">${ex}</li>`).join('')}</ul>`;
                html += `<div class="mt-6 text-center"><button class="log-session-btn bg-green-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-700" data-week="${week}" data-day-index="${index}">Log this Session</button></div></div>`;
            });
            html += `</div>`;
            workoutDisplay.innerHTML = html;
            workoutDisplay.querySelectorAll('.day-tab').forEach(tab => {
                tab.addEventListener('click', e => {
                    const dayIndex = e.target.dataset.day;
                    workoutDisplay.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active', 'bg-gray-100'));
                    workoutDisplay.querySelectorAll('.day-tab').forEach((t, i) => { if (i.toString() !== dayIndex) t.classList.add('bg-gray-100'); });
                    e.target.classList.add('active');
                    e.target.classList.remove('bg-gray-100');
                    workoutDisplay.querySelectorAll('.day-content').forEach(c => c.classList.toggle('hidden', c.dataset.dayContent !== dayIndex));
                });
            });
            workoutDisplay.querySelectorAll('.log-session-btn').forEach(btn => btn.addEventListener('click', e => openLogModal(e.target.dataset.week, e.target.dataset.dayIndex)));
        };
        weekSelector.addEventListener('change', e => displayWorkout(e.target.value));
        const calculateVolume = () => programData.weeks.map(block => {
            let upperSets = 0, lowerSets = 0;
            block.days.forEach(day => {
                const setCount = day.exercises.reduce((acc, ex) => acc + (parseInt(ex.match(/(\d+)\s*set/)?.[1] || 0)), 0);
                if (day.day.includes('Upper')) upperSets += setCount; else lowerSets += setCount;
            });
            return { upperSets, lowerSets };
        });
        const volumeData = calculateVolume();
        new Chart(document.getElementById('volumeChart').getContext('2d'), {
            type: 'bar',
            data: { labels: ['Weeks 1-4', 'Weeks 5-8', 'Weeks 9-12', 'Weeks 13-16'], datasets: [{ label: 'Upper Body Sets', data: volumeData.map(d => d.upperSets), backgroundColor: 'rgba(197, 160, 109, 0.7)' }, { label: 'Lower Body Sets', data: volumeData.map(d => d.lowerSets), backgroundColor: 'rgba(90, 90, 90, 0.6)' }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'Total Weekly Sets' } } } }
        });
        
        CLIENT_ID_INPUT.value = localStorage.getItem('googleClientId') || '';
        CLIENT_ID_INPUT.onchange = () => localStorage.setItem('googleClientId', CLIENT_ID_INPUT.value);
        
        document.addEventListener('DOMContentLoaded', () => {
            loadLogs();
            displayWorkout(1);
        });
    </script>
</body>
</html>

